



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
        <link rel="canonical" href="https://red-hat-storage.github.io/RHCS_Test_Drive/Module-5/">
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../images/favicon.ico">
      <meta name="generator" content="mkdocs-0.17.2, mkdocs-material-2.5.0">
    
    
      
        <title>Module-5 : Ceph File Storage - Red Hat Ceph Storage Test Drive</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.2a88008a.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.792431c1.css">
      
    
    
      <script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
  
    
    
    <body dir="ltr" data-md-color-primary="red" data-md-color-accent="red">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://red-hat-storage.github.io/RHCS_Test_Drive" title="Red Hat Ceph Storage Test Drive" class="md-header-nav__button md-logo">
          
            <img src="../images/shadowman_rgb.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Red Hat Ceph Storage Test Drive
              </span>
              <span class="md-header-nav__topic">
                Module-5 : Ceph File Storage
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <img src="../images/shadowman_rgb.png" width="24" height="24">
      
    </span>
    Red Hat Ceph Storage Test Drive
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Module-1/" title="Module-1 : Introduction to RHCS" class="md-nav__link">
      Module-1 : Introduction to RHCS
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Module-2/" title="Module-2 : Deploying RHCS" class="md-nav__link">
      Module-2 : Deploying RHCS
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Module-3/" title="Module-3 : Ceph Block Storage" class="md-nav__link">
      Module-3 : Ceph Block Storage
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Module-4/" title="Module-4 : Ceph Object Storage" class="md-nav__link">
      Module-4 : Ceph Object Storage
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Module-5 : Ceph File Storage
      </label>
    
    <a href="./" title="Module-5 : Ceph File Storage" class="md-nav__link md-nav__link--active">
      Module-5 : Ceph File Storage
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" title="Introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploying-ceph-metadata-server-mds" title="Deploying Ceph Metadata Server (MDS)" class="md-nav__link">
    Deploying Ceph Metadata Server (MDS)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setting-up-ceph-filesystem" title="Setting up Ceph Filesystem" class="md-nav__link">
    Setting up Ceph Filesystem
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#accessing-ceph-filesystem" title="Accessing Ceph Filesystem" class="md-nav__link">
    Accessing Ceph Filesystem
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Module-6/" title="Module-6 : Ceph Administration" class="md-nav__link">
      Module-6 : Ceph Administration
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" title="Introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploying-ceph-metadata-server-mds" title="Deploying Ceph Metadata Server (MDS)" class="md-nav__link">
    Deploying Ceph Metadata Server (MDS)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setting-up-ceph-filesystem" title="Setting up Ceph Filesystem" class="md-nav__link">
    Setting up Ceph Filesystem
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#accessing-ceph-filesystem" title="Accessing Ceph Filesystem" class="md-nav__link">
    Accessing Ceph Filesystem
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="module-5-ceph-file-storage-provisioning">Module - 5 : Ceph File Storage Provisioning<a class="headerlink" href="#module-5-ceph-file-storage-provisioning" title="Permanent link">#</a></h1>
<div class="admonition summary">
<p class="admonition-title">Module Agenda</p>
<ul>
<li><strong>In this module, you will learn how to configure Ceph Metadata Server (MDS)</strong></li>
<li><strong>You will then use CephFS to provision, mount and use a shared filesystem based on Ceph</strong></li>
<li><strong>By the end of this module, you will have an understanding of Ceph Filesystem.</strong></li>
</ul>
</div>
<ul>
<li>From your workstation, login to the <code class="codehilite">ceph-admin</code> node as user <strong><code class="codehilite">student</code></strong> <a href="https://red-hat-storage.github.io/RHCS_Test_Drive/#starting-the-lab">(Learn how to Login)</a></li>
</ul>
<div class="codehilite"><pre><span></span>ssh student@&lt;IP Address of ceph-admin node&gt;
</pre></div>

<div class="admonition example">
<p class="admonition-title">Prerequisite</p>
<ul>
<li><strong>This module is independent of the other modules. If you intend to follow this module, please make sure that you have a running Ceph cluster before you begin.</strong></li>
<li><strong>You could setup a Ceph cluster using either of these two methods<br />
1) Follow the hands-on instructions in Module-2 and deploy the Ceph cluster<br />
2) From <code class="codehilite">ceph-admin</code> node, execute the following script to setup a Ceph cluster<br />
<code class="codehilite">sh /home/student/auto-pilot/setup_ceph_cluster.sh</code></strong></li>
<li><strong>Once you have a running Ceph cluster you will be ready to continue with this module.</strong></li>
<li><strong>You must run all the commands using user <code class="codehilite">student</code> on the <code class="codehilite">ceph-admin</code> node, unless otherwise specified.</strong></li>
</ul>
</div>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">#</a></h2>
<p>The Ceph File System (CephFS) is a file system compatible with POSIX standards that provides file access to a Ceph Storage Cluster. CephFS requires at least one Metadata Server (MDS) daemon. The MDS daemon manages metadata related to files stored on the Ceph File System and also coordinates access to the shared Ceph Storage Cluster.</p>
<h2 id="deploying-ceph-metadata-server-mds">Deploying Ceph Metadata Server (MDS)<a class="headerlink" href="#deploying-ceph-metadata-server-mds" title="Permanent link">#</a></h2>
<ul>
<li>
<p>In most cases, the default settings for MDS in <code class="codehilite">ceph-ansible</code> are appropriate. To setup MDS, we just need to update the Ansible inventory file with MDS host detail</p>
</li>
<li>
<p>Edit Ansible inventory file <code class="codehilite">/etc/ansible/hosts</code> </p>
</li>
</ul>
<div class="codehilite"><pre><span></span>sudo vim /etc/ansible/hosts
</pre></div>

<ul>
<li>Add the following section, save and exit from file editor</li>
</ul>
<div class="codehilite"><pre><span></span><span class="k">[mdss]</span>
<span class="na">ceph-admin</span>
</pre></div>

<ul>
<li>Switch directory to the <code class="codehilite">ceph-ansible</code> root</li>
</ul>
<div class="codehilite"><pre><span></span>cd /usr/share/ceph-ansible
</pre></div>

<ul>
<li>Run the <code class="codehilite">ceph-ansible</code> playbook and limit it to <code class="codehilite">mdss</code> </li>
</ul>
<div class="codehilite"><pre><span></span>time ansible-playbook site.yml --limit mdss
</pre></div>

<ul>
<li>Give user <code class="codehilite">student</code> access to the Ceph CLI </li>
</ul>
<div class="codehilite"><pre><span></span>sudo chown -R student:student /etc/ceph
</pre></div>

<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Ansible is idempotent. If it is run multiple times, it has the same effect as running it once. Therefore, there is no harm in running it again. Configuration changes will not take place after its initial application.</p>
</div>
<ul>
<li>Once your Ansible playbook run has finished, ensure there are no failed items under <code class="codehilite">PLAY RECAP</code> </li>
</ul>
<h2 id="setting-up-ceph-filesystem">Setting up Ceph Filesystem<a class="headerlink" href="#setting-up-ceph-filesystem" title="Permanent link">#</a></h2>
<ul>
<li>Create a CephFS data pool</li>
</ul>
<div class="codehilite"><pre><span></span>ceph osd pool create cephfs-data 64
</pre></div>

<ul>
<li>Create a CephFS meta data pool</li>
</ul>
<div class="codehilite"><pre><span></span>ceph osd pool create cephfs-metadata 64
</pre></div>

<ul>
<li>Create Ceph Filesystem</li>
</ul>
<div class="codehilite"><pre><span></span>ceph fs new cephfs cephfs-metadata cephfs-data
</pre></div>

<ul>
<li>Enable the cephfs application for Ceph data and metadata pools</li>
</ul>
<div class="codehilite"><pre><span></span>ceph osd pool application enable cephfs-data cephfs ; ceph osd pool application enable cephfs-metadata cephfs ; 
</pre></div>

<ul>
<li>Check the Ceph Filesystem status</li>
</ul>
<div class="codehilite"><pre><span></span>ceph fs status cephfs
</pre></div>

<ul>
<li>Create a CephFS client user named <code class="codehilite">client.cephfs</code> with necessary permissions on Ceph MON, MDS and OSD</li>
</ul>
<div class="codehilite"><pre><span></span>ceph auth get-or-create client.cephfs mon &#39;allow r&#39; mds &#39;allow rw&#39; osd &#39;allow rwx pool=cephfs-metadata,allow rwx pool=cephfs-data&#39;
</pre></div>

<h2 id="accessing-ceph-filesystem">Accessing Ceph Filesystem<a class="headerlink" href="#accessing-ceph-filesystem" title="Permanent link">#</a></h2>
<ul>
<li>To access CephFS, you will need to extract and place a CephFS secret key on to the client node</li>
</ul>
<div class="codehilite"><pre><span></span>ceph auth get client.cephfs | grep -i key | cut -d &#39; &#39; -f 3 &gt; /tmp/ceph.client.cephfs.secret
</pre></div>

<ul>
<li>Copy the CephFS secret file to <code class="codehilite">client-node1</code> </li>
</ul>
<div class="codehilite"><pre><span></span><span class="nt">scp</span> <span class="o">/</span><span class="nt">tmp</span><span class="o">/</span><span class="nt">ceph</span><span class="p">.</span><span class="nc">client</span><span class="p">.</span><span class="nc">cephfs</span><span class="p">.</span><span class="nc">secret</span> <span class="nt">client-node1</span><span class="o">:</span> <span class="o">;</span>
</pre></div>

<ul>
<li>Connect to <code class="codehilite">client-node1</code> in order to mount the Ceph Filesystem</li>
</ul>
<div class="codehilite"><pre><span></span>ssh client-node1
</pre></div>

<ul>
<li>Switch to <code class="codehilite">root</code> user</li>
</ul>
<div class="codehilite"><pre><span></span>sudo su -
</pre></div>

<ul>
<li>Create a mount point </li>
</ul>
<div class="codehilite"><pre><span></span>mkdir /mnt/cephfs
</pre></div>

<ul>
<li>Then, mount the Ceph Filesystem using the <code class="codehilite">mount</code> command and add an option, <code class="codehilite">-o</code>, providing your CephFS secret file</li>
</ul>
<div class="codehilite"><pre><span></span>mount -t ceph 10.100.0.11:6789,10.100.0.12:6789,10.100.0.13:6789:/ /mnt/cephfs/ -o name=cephfs,secretfile=/home/student/ceph.client.cephfs.secret
</pre></div>

<ul>
<li>Verify that the Ceph Filesystem is mounted</li>
</ul>
<div class="codehilite"><pre><span></span>df -h /mnt/cephfs
</pre></div>

<ul>
<li>Next, let&rsquo;s copy a medium-sized file to the Ceph Filesystem</li>
</ul>
<div class="codehilite"><pre><span></span>cp /home/student/rhceph-3.0-rhel-7-x86_64.iso /mnt/cephfs/
</pre></div>

<ul>
<li>Verify the copied files</li>
</ul>
<div class="codehilite"><pre><span></span>ls -l /mnt/cephfs ; df -h /mnt/cephfs
</pre></div>

<p>You can also mount the same Ceph Filesystem on other nodes in the cluster. As an example, let&rsquo;s mount cephfs to the <code class="codehilite">ceph-admin</code> node as well</p>
<ul>
<li>Login to <code class="codehilite">ceph-admin</code> node , switch to root user <code class="codehilite">sudo su -</code> and create mount point for cephfs</li>
</ul>
<div class="codehilite"><pre><span></span>ssh ceph-admin
</pre></div>

<div class="codehilite"><pre><span></span>sudo su -
</pre></div>

<div class="codehilite"><pre><span></span>mkdir /mnt/cephfs
</pre></div>

<ul>
<li>Again, mount the Ceph Filesystem as you did in the previous example, using the <code class="codehilite">mount</code> command and adding an option, <code class="codehilite">-o</code>, to provide your CephFS secret file</li>
</ul>
<div class="codehilite"><pre><span></span>mount -t ceph 10.100.0.11:6789,10.100.0.12:6789,10.100.0.13:6789:/ /mnt/cephfs/ -o name=cephfs,secretfile=/tmp/ceph.client.cephfs.secret
</pre></div>

<ul>
<li>Verify the contents of Ceph Filesystem. As expected, the contents will be same as we saw on <code class="codehilite">client-node1</code></li>
</ul>
<div class="codehilite"><pre><span></span>ls -l  /mnt/cephfs
</pre></div>

<div class="admonition summary">
<p class="admonition-title">End of Module</p>
<p><strong>We have reached the end of Module-5. In this module, you have learned how to install, configure and use Ceph as a distributed shared filesystem. In the next module, you will learn Ceph Administration.</strong></p>
</div>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../Module-4/" title="Module-4 : Ceph Object Storage" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Module-4 : Ceph Object Storage
              </span>
            </div>
          </a>
        
        
          <a href="../Module-6/" title="Module-6 : Ceph Administration" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Module-6 : Ceph Administration
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright ©2018 Red Hat, Inc.
          </div>
        
        powered by
        <a href="http://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
      <a href="https://www.redhat.com/en/technologies/storage/ceph" class="md-footer-social__link fa fa-link"></a>
    
      <a href="https://twitter.com/RedHatStorage" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://github.com/ceph/ceph" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://www.linkedin.com/company/3545/" class="md-footer-social__link fa fa-linkedin"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.ce2ab4bf.js"></script>
      
      <script>app.initialize({version:"0.17.2",url:{base:".."}})</script>
      
    
    
      
    
  </body>
</html>