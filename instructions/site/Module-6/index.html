



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
        <link rel="canonical" href="https://red-hat-storage.github.io/RHCS_Test_Drive/Module-6/">
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../images/favicon.ico">
      <meta name="generator" content="mkdocs-0.17.2, mkdocs-material-2.5.0">
    
    
      
        <title>Module-6 : Ceph Administration - Red Hat Ceph Storage Test Drive</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.2a88008a.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.792431c1.css">
      
    
    
      <script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
  
    
    
    <body dir="ltr" data-md-color-primary="red" data-md-color-accent="red">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://red-hat-storage.github.io/RHCS_Test_Drive" title="Red Hat Ceph Storage Test Drive" class="md-header-nav__button md-logo">
          
            <img src="../images/shadowman_rgb.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Red Hat Ceph Storage Test Drive
              </span>
              <span class="md-header-nav__topic">
                Module-6 : Ceph Administration
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <img src="../images/shadowman_rgb.png" width="24" height="24">
      
    </span>
    Red Hat Ceph Storage Test Drive
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Module-1/" title="Module-1 : Introduction to RHCS" class="md-nav__link">
      Module-1 : Introduction to RHCS
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Module-2/" title="Module-2 : Deploying RHCS" class="md-nav__link">
      Module-2 : Deploying RHCS
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Module-3/" title="Module-3 : Ceph Block Storage" class="md-nav__link">
      Module-3 : Ceph Block Storage
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Module-4/" title="Module-4 : Ceph Object Storage" class="md-nav__link">
      Module-4 : Ceph Object Storage
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Module-5/" title="Module-5 : Ceph File Storage" class="md-nav__link">
      Module-5 : Ceph File Storage
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Module-6 : Ceph Administration
      </label>
    
    <a href="./" title="Module-6 : Ceph Administration" class="md-nav__link md-nav__link--active">
      Module-6 : Ceph Administration
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#scale-out-a-ceph-cluster" title="Scale-Out a Ceph Cluster" class="md-nav__link">
    Scale-Out a Ceph Cluster
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#scale-out-a-ceph-cluster" title="Scale-Out a Ceph Cluster" class="md-nav__link">
    Scale-Out a Ceph Cluster
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="module-6-ceph-administration">Module - 6 : Ceph Administration<a class="headerlink" href="#module-6-ceph-administration" title="Permanent link">#</a></h1>
<div class="admonition summary">
<p class="admonition-title">Module Agenda</p>
<ul>
<li><strong>In this module you will perform Ceph Day-2 administration tasks, such as cluster monitoring, scaling out, etc.</strong></li>
<li><strong>You will also learn how Filestore and Bluestore OSD can coexist seamlessly in the same Ceph cluster</strong></li>
</ul>
</div>
<ul>
<li>From your workstation login to the <code class="codehilite">ceph-admin</code> node as user <strong><code class="codehilite">student</code></strong> <a href="https://red-hat-storage.github.io/RHCS_Test_Drive/#starting-the-lab">(Learn how to Login)</a></li>
</ul>
<div class="codehilite"><pre><span></span>ssh student@&lt;IP Address of ceph-admin node&gt;
</pre></div>

<div class="admonition example">
<p class="admonition-title">Prerequisite</p>
<ul>
<li><strong>This module is independent of the other modules. If you intend to follow this module, please make sure that you have a running Ceph cluster before you begin.</strong></li>
<li><strong>You could setup a Ceph cluster using either of these two methods<br />
1) Follow the hands-on instruction in Module-2 and deploy the Ceph cluster<br />
2) From <code class="codehilite">ceph-admin</code> node, execute the following script to setup a Ceph cluster<br />
<code class="codehilite">sh /home/student/auto-pilot/setup_ceph_cluster.sh</code></strong></li>
<li><strong>Once you have a running Ceph cluster, you will be ready to continue with this module.</strong></li>
<li><strong>You must run all the commands using user <code class="codehilite">student</code> on the <code class="codehilite">ceph-admin</code> node, unless otherwise specified.</strong></li>
</ul>
</div>
<h2 id="scale-out-a-ceph-cluster">Scale-Out a Ceph Cluster<a class="headerlink" href="#scale-out-a-ceph-cluster" title="Permanent link">#</a></h2>
<p>Ceph is a distributed storage system designed to scale to hundreds of petabytes. In Module-2 you deployed a 3 OSD node (12 OSDs) Ceph cluster. In this section you will scale out your Ceph cluster by adding a new OSD node (4 OSDs) to it.</p>
<ul>
<li>
<p>Before we begin to add a new node to the cluster, make sure OS, SSH keys and networking is properly setup. In our case we already have the new node <code class="codehilite">ceph-node4</code> setup correctly.</p>
</li>
<li>
<p>Starting with RHCS 3.0, a new OSD storage back-end has been introduced in Tech-Preview known as BlueStore.</p>
</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>OSD BlueStore is a new back end for the OSD daemons. Compared to the currently used FileStore back end, BlueStore allows for storing objects directly on the block devices without any file system interface, which improves the performance of the cluster.</p>
</div>
<ul>
<li>
<p>To demonstrate that both Filestore (the current OSD backend) and Bluestore (the new OSD backend) can reside in the same cluster, we shall add <code class="codehilite">ceph-node4</code> as a Bluestore node.</p>
</li>
<li>
<p>Edit Ansible inventory file <code class="codehilite">/etc/ansible/hosts</code> </p>
</li>
</ul>
<div class="codehilite"><pre><span></span>sudo vim /etc/ansible/hosts
</pre></div>

<ul>
<li>Add the host name of the new node under <code class="codehilite">[osds]</code> section as shown below.</li>
</ul>
<div class="codehilite"><pre><span></span><span class="k">[osds]</span>
<span class="na">ceph-node4</span>
</pre></div>

<ul>
<li>Next edit the ceph-ansible configuration file and change the OSD <code class="codehilite">osd_objectstore</code> backend from filestore to bluestore.</li>
</ul>
<div class="codehilite"><pre><span></span>sudo sed -i &#39;s/filestore/bluestore/&#39; /usr/share/ceph-ansible/group_vars/all.yml
</pre></div>

<ul>
<li>To scale out the Ceph cluster, switch to the ceph-ansible root directory</li>
</ul>
<div class="codehilite"><pre><span></span>cd /usr/share/ceph-ansible
</pre></div>

<ul>
<li>Before adding a node to your Ceph cluster, let&rsquo;s check OSD stat and OSD tree</li>
</ul>
<div class="codehilite"><pre><span></span>ceph osd stat ; ceph osd tree
</pre></div>

<ul>
<li>As you can see, there are currently 12 OSDs in 3 OSD nodes. We shall use the <code class="codehilite">ceph-ansible</code> playbook to scale out the Ceph cluster </li>
</ul>
<div class="codehilite"><pre><span></span>time ansible-playbook site.yml
</pre></div>

<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Ansible is idempotent. If it is run multiple times, it has the same effect as running it once. Therefore, there is no harm in running it again. Configuration changes will not take place after its initial application.</p>
</div>
<ul>
<li>
<p>Once your Ansible playbook run has finished, ensure there are no failed items under <code class="codehilite">PLAY RECAP</code> </p>
</li>
<li>
<p>Allow user <code class="codehilite">student</code> to access the Ceph cluster</p>
</li>
</ul>
<div class="codehilite"><pre><span></span>sudo chown -R student:student /etc/ceph
</pre></div>

<ul>
<li>Verify the changes in Ceph OSD stat and OSD tree. You should now see a total of 16 OSDs in 4 OSD hosts.</li>
</ul>
<div class="codehilite"><pre><span></span>ceph -s
</pre></div>

<div class="codehilite"><pre><span></span>ceph osd stat
</pre></div>

<div class="codehilite"><pre><span></span>ceph osd tree
</pre></div>

<ul>
<li>Let&rsquo;s now add this new host (<code class="codehilite">ceph-node4</code>) to the Ceph Metrics Monitoring Dashboard. Switch to the Ceph Metrics Ansible directory and run the Ceph Metrics playbook</li>
</ul>
<div class="codehilite"><pre><span></span>cd /usr/share/cephmetrics-ansible
</pre></div>

<div class="codehilite"><pre><span></span>time ansible-playbook playbook.yml
</pre></div>

<ul>
<li>
<p>At this point you have </p>
<ul>
<li>Scaled out your Ceph cluster from 3 nodes to 4 nodes (12 OSDs to 16 OSDs)</li>
<li>Configured OSDs on the new node as Bluestore Objectstore</li>
<li>Observed that Filestore and Bluestore OSDs are co-existing on the same cluster</li>
<li>Added the new node to the Ceph Monitoring Dashboard</li>
</ul>
</li>
<li>
<p>To check OSD summary, go to <code class="codehilite">Ceph OSD Information</code> panel </p>
</li>
</ul>
<p><a href="../images/module_6_ceph_dashboard_1.png"><img alt="Ceph Metrics Dashboard At Glance" src="../images/module_6_ceph_dashboard_1.png" /></a></p>
<ul>
<li>Check the <code class="codehilite">Summary of OSD Types</code> </li>
</ul>
<p><a href="../images/module_6_ceph_dashboard_2.png"><img alt="Ceph Metrics Dashboard At Glance" src="../images/module_6_ceph_dashboard_2.png" /></a></p>
<div class="admonition summary">
<p class="admonition-title">End of Module</p>
<p><strong>We have reached the end of Module-6. In this module you have learned how to add nodes to a Ceph cluster, configured Bluestore OSDs in a cluster co-existing with Filestore OSDs, and add the new node to the Ceph Monitoring Dashboard. This concludes the Red Hat Ceph Storage 3 Test Drive. Additional modules will be added as new features are released, so please visit again!</strong></p>
</div>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../Module-5/" title="Module-5 : Ceph File Storage" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Module-5 : Ceph File Storage
              </span>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright ©2018 Red Hat, Inc.
          </div>
        
        powered by
        <a href="http://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
      <a href="https://www.redhat.com/en/technologies/storage/ceph" class="md-footer-social__link fa fa-link"></a>
    
      <a href="https://twitter.com/RedHatStorage" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://github.com/ceph/ceph" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://www.linkedin.com/company/3545/" class="md-footer-social__link fa fa-linkedin"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.ce2ab4bf.js"></script>
      
      <script>app.initialize({version:"0.17.2",url:{base:".."}})</script>
      
    
    
      
    
  </body>
</html>